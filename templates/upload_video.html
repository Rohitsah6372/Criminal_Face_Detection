{% extends 'base.html' %}
{% block content %}
<h2>Upload CCTV Video for Detection</h2>
<form id="videoUploadForm" class="mt-3" enctype="multipart/form-data">
  <div class="mb-3">
    <label for="video" class="form-label">Select Video File</label>
    <input class="form-control" type="file" id="video" name="video" accept="video/*" required>
  </div>
  <button type="submit" class="btn btn-primary">Upload & Detect</button>
</form>
<div id="detectionResult" class="mt-4"></div>
<script>
document.getElementById('videoUploadForm').onsubmit = function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const resultDiv = document.getElementById('detectionResult');
  resultDiv.innerHTML = '<div class="alert alert-info">Processing video, please wait...</div>';
  fetch('/upload_video', {
    method: 'POST',
    body: formData
  })
    .then(res => res.json())
    .then(data => {
      if (data.status === 'success') {
        if (data.detected_criminals.length > 0) {
          resultDiv.innerHTML = `<div class='alert alert-danger'><strong>Detected Criminals:</strong><ul>${data.detected_criminals.map(name => `<li>${name}</li>`).join('')}</ul></div>`;
        } else {
          resultDiv.innerHTML = `<div class='alert alert-success'>No criminals detected in the video.</div>`;
        }
      } else {
        resultDiv.innerHTML = `<div class='alert alert-danger'>${data.message}</div>`;
      }
    })
    .catch(() => {
      resultDiv.innerHTML = `<div class='alert alert-danger'>An error occurred during detection.</div>`;
    });
};
</script>
{% endblock %} 